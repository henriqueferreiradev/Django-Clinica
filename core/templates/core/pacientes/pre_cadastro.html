{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Pré-cadastro de pacientes para a clínica Ponto de Equilíbrio"
    />
    <title>Ponto de Equilíbrio - Pré-cadastro</title>
    {% block extra_css %}
    <link
      rel="stylesheet"
      href="{% static 'core/css/pacientes/pre_cadastro.css' %}"
    />
    <link rel="icon" href="{% static 'core/img/icons/logoRoxoFull.png' %}" type="image/png">
    <link rel="stylesheet" href="{% static 'core/css/alerts.css' %}" />
    <link rel="stylesheet" href="{% static 'core/css/tema.css' %}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    {% endblock %}
  </head>
  <body>
    <header class="header">
      <div class="container">
        <div class="header-content">
          <h1 class="header-title fade-in">Pré-Cadastro de Paciente</h1>
          <p class="header-subtitle fade-in">
            Preencha os dados abaixo para agilizar seu atendimento inicial.
            Nossa equipe entrará em contato após a conferência.
          </p>
          <a
            href="#form-section"
            class="btn btn-white slide-up"
            aria-label="Ir para o formulário de cadastro"
            >Ir para o formulário</a
          >
        </div>
      </div>

      <!-- SVG Curve -->
      <div class="header-curve" aria-hidden="true">
        <svg
          data-name="Layer 1"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1200 120"
          preserveAspectRatio="none"
        >
          <defs>
            <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#8641a1" />
              <stop offset="100%" stop-color="#7F4396" />
            </linearGradient>
          </defs>
          <path
            d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z"
            opacity=".25"
            class="shape-fill"
          ></path>
          <path
            d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z"
            opacity=".5"
            class="shape-fill"
          ></path>
          <path
            d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z"
            class="shape-fill"
          ></path>
        </svg>
      </div>
    </header>

    <main id="form-section" class="form-section">
      <div class="container">
        <div class="content">
          <!-- Progress Steps -->
          <div class="form-progress">
            <div class="progress-step active" data-step="1" aria-current="step">
              <span class="step-number">1</span>
              <span class="step-text">Informações Pessoais</span>
            </div>
            <div class="progress-step" data-step="2">
              <span class="step-number">2</span>
              <span class="step-text">Endereço e Contato</span>
            </div>
          </div>

          <form
            method="post"
            enctype="multipart/form-data"
            class="multi-step-form"
            id="multiStepForm"
            novalidate
          >
            {% csrf_token %}

            <!-- ETAPA 1 -->
            <div
              class="form-step active"
              id="step-1"
              role="tabpanel"
              aria-labelledby="step-1-tab"
            >
              <h2 class="form-step-title">Informações Pessoais</h2>

              <div class="form-step-content">
                <!-- Nome, Sobrenome, Nome Social -->
                <div class="form-row">
                  <div class="form-field">
                    <label for="nome" class="form-label">
                      Nome <span class="required">*</span>
                    </label>
                    <input
                      id="nome"
                      class="form-input capitalize-input"
                      type="text"
                      name="nome"
                      required
                      aria-required="true"
                    />
                  </div>

                  <div class="form-field">
                    <label for="sobrenome" class="form-label">
                      Sobrenome <span class="required">*</span>
                    </label>
                    <input
                      id="sobrenome"
                      class="form-input capitalize-input"
                      type="text"
                      name="sobrenome"
                      required
                      aria-required="true"
                    />
                  </div>

                  <div class="form-field">
                    <label for="nomeSocial" class="form-label"
                      >Nome Social</label
                    >
                    <input
                      id="nomeSocial"
                      class="form-input capitalize-input"
                      type="text"
                      name="nomeSocial"
                    />
                  </div>
                </div>

                <!-- RG, CPF, Nascimento -->
                <div class="form-row">
                  <div class="form-field">
                    <label for="rg" class="form-label">RG</label>
                    <input
                      id="rg"
                      class="form-input"
                      type="text"
                      name="rg"
                      inputmode="numeric"
                    />
                  </div>

                  <div class="form-field">
                    <label for="cpf" class="form-label">
                      CPF <span class="required">*</span>
                    </label>
                    <input
                      id="cpf"
                      class="form-input cpf-mask"
                      type="text"
                      name="cpf"
                      required
                      aria-required="true"
                      inputmode="numeric"
                    />
                    <span id="cpf-feedback" class="error-message"></span>
                  </div>

                  <div class="form-field">
                    <label for="nascimento" class="form-label">
                      Nascimento <span class="required">*</span>
                    </label>
                    <input
                      id="nascimento"
                      class="form-input date-mask"
                      type="text"
                      name="nascimento"
                      required
                      aria-required="true"
                      placeholder="DD/MM/AAAA"
                    />
                  </div>
                </div>

                <!-- Cor, Sexo, Estado Civil, Profissão -->
                <div class="form-row">
                  <div class="form-field">
                    <label for="cor" class="form-label">Cor/Raça</label>
                    <select id="cor" name="cor" class="form-select">
                      <option value="" disabled selected>Selecione</option>
                      {% for value, label in cor_choices %}
                      <option value="{{ value }}">{{ label }}</option>
                      {% endfor %}
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="sexo" class="form-label">Sexo</label>
                    <select id="sexo" name="sexo" class="form-select">
                      <option value="" disabled selected>Selecione</option>
                      {% for value, label in sexo_choices %}
                      <option value="{{ value }}">{{ label }}</option>
                      {% endfor %}
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="estado_civil" class="form-label">
                      Estado Civil <span class="required">*</span>
                    </label>
                    <select
                      id="estado_civil"
                      name="estado_civil"
                      class="form-select"
                      required
                      aria-required="true"
                    >
                      <option value="" disabled selected>Selecione</option>
                      {% for value, label in estado_civil_choices %}
                      <option value="{{ value }}">{{ label }}</option>
                      {% endfor %}
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="profissao" class="form-label">Profissão</label>
                    <input
                      id="profissao"
                      class="form-input"
                      type="text"
                      name="profissao"
                    />
                  </div>
                </div>

                <!-- Naturalidade, UF, Mídia, Rede Social -->
                <div class="form-row">
                  <div class="form-field">
                    <label for="naturalidade" class="form-label">
                      Naturalidade <span class="required">*</span>
                    </label>
                    <input
                      id="naturalidade"
                      class="form-input"
                      type="text"
                      name="naturalidade"
                      required
                      aria-required="true"
                    />
                  </div>

                  <div class="form-field">
                    <label for="uf" class="form-label">
                      UF <span class="required">*</span>
                    </label>
                    <select
                      id="uf"
                      name="uf"
                      class="form-select"
                      required
                      aria-required="true"
                    >
                      <option value="" disabled selected>Selecione</option>
                      {% for value, label in uf_choices %}
                      <option value="{{ value }}">{{ label }}</option>
                      {% endfor %}
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="midia" class="form-label">
                      Como nos conheceu? <span class="required">*</span>
                    </label>
                    <select
                      id="midia"
                      name="midia"
                      class="form-select"
                      required
                      aria-required="true"
                    >
                      <option value="" disabled selected>Selecione</option>
                      {% for value, label in midia_choices %}
                      <option value="{{ value }}">{{ label }}</option>
                      {% endfor %}
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="redeSocial" class="form-label"
                      >Rede Social</label
                    >
                    <input
                      id="redeSocial"
                      class="form-input"
                      type="text"
                      name="redeSocial"
                    />
                  </div>
                </div>

                <!-- Foto + Observação -->
                <div class="form-row">
                  <div class="form-field form-field-file">
                    <label for="file" class="form-label">Foto (opcional)</label>
                    <div class="file-upload-wrapper">
                      <input 
                        id="file"
                        name="foto"
                        type="file"
                        accept="image/*"
                        onchange="previewImage(event)"
                        aria-describedby="fileHelp"
                      />
                      <label for="file" class="file-upload-label">
                        <span class="file-upload-icon">
                          <svg
                            viewBox="0 0 24 24"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path
                              d="M12 5V19M5 12H19"
                              stroke="#7F4396"
                              stroke-width="2"
                              stroke-linecap="round"
                            />
                          </svg>
                        </span>
                        <span class="file-upload-text">Selecione uma foto</span>
                      </label>
                      <div id="filePreview" class="file-preview"></div>
                      <small id="fileHelp" class="form-help-text"
                        >Formatos aceitos: JPG, PNG (máx. 2MB)</small
                      >
                    </div>
                  </div>

                  <div class="form-field">
                    <label for="observacao" class="form-label"
                      >Observação</label
                    >
                    <textarea
                      id="observacao"
                      class="form-textarea"
                      name="observacao"
                      maxlength="500"
                      aria-describedby="charCount"
                    ></textarea>
                    <div id="charCount" class="char-count">
                      <span class="current-count">0</span>/500 caracteres
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-navigation">
                <button
                  type="button"
                  class="btn btn-next"
                  aria-controls="step-2"
                >
                  Próximo
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M5 12H19M19 12L12 5M19 12L12 19"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
              </div>
            </div>

            <!-- ETAPA 2 -->
            <div
              class="form-step"
              id="step-2"
              role="tabpanel"
              aria-labelledby="step-2-tab"
            >
              <h2 class="form-step-title">Endereço e Contato</h2>

              <div class="form-step-content">
                <!-- CEP, Rua -->
                <div class="form-row">
                  <div class="form-field">
                    <label for="cep" class="form-label">
                      CEP <span class="required">*</span>
                    </label>
                    <input
                      id="cep"
                      class="form-input cep-mask"
                      type="text"
                      name="cep"
                      required
                      aria-required="true"
                      inputmode="numeric"
                    />
                    <button
                      type="button"
                      class="btn-cep-search"
                      id="btnBuscarCep"
                    >
                      Buscar CEP
                    </button>
                  </div>

                  <div class="form-field">
                    <label for="rua" class="form-label">
                      Rua <span class="required">*</span>
                    </label>
                    <input
                      id="rua"
                      class="form-input capitalize-input"
                      type="text"
                      name="rua"
                      required
                      aria-required="true"
                    />
                  </div>
                </div>

                <!-- Número, Complemento -->
                <div class="form-row">
                  <div class="form-field">
                    <label for="numero" class="form-label">
                      Número <span class="required">*</span>
                    </label>
                    <input
                      id="numero"
                      class="form-input"
                      type="text"
                      name="numero"
                      required
                      aria-required="true"
                    />
                  </div>

                  <div class="form-field">
                    <label for="complemento" class="form-label"
                      >Complemento</label
                    >
                    <input
                      id="complemento"
                      class="form-input"
                      type="text"
                      name="complemento"
                    />
                  </div>
                </div>

                <!-- Bairro, Cidade, Estado -->
                <div class="form-row">
                  <div class="form-field">
                    <label for="bairro" class="form-label">
                      Bairro <span class="required">*</span>
                    </label>
                    <input
                      id="bairro"
                      class="form-input"
                      type="text"
                      name="bairro"
                      required
                      aria-required="true"
                    />
                  </div>

                  <div class="form-field">
                    <label for="cidade" class="form-label">
                      Cidade <span class="required">*</span>
                    </label>
                    <input
                      id="cidade"
                      class="form-input"
                      type="text"
                      name="cidade"
                      required
                      aria-required="true"
                    />
                  </div>

                  <div class="form-field">
                    <label for="estado" class="form-label">
                      UF <span class="required">*</span>
                    </label>
                    <input
                      id="estado"
                      class="form-input"
                      type="text"
                      name="estado"
                      required
                      aria-required="true"
                      maxlength="2"
                    />
                  </div>
                </div>

                <!-- Contato -->
                <div class="form-row">
                  <div class="form-field">
                    <label for="telefone" class="form-label">Telefone</label>
                    <input
                      id="telefone"
                      class="form-input phone-mask"
                      type="text"
                      name="telefone"
                      inputmode="tel"
                    />
                  </div>

                  <div class="form-field">
                    <label for="celular" class="form-label">
                      Celular <span class="required">*</span>
                    </label>
                    <input
                      id="celular"
                      class="form-input cellphone-mask"
                      type="text"
                      name="celular"
                      required
                      aria-required="true"
                      inputmode="tel"
                    />
                  </div>
                </div>

                <!-- Email -->
                <div class="form-row">
                  <div class="form-field">
                    <label for="email" class="form-label">
                      Email <span class="required">*</span>
                    </label>
                    <input
                      id="email"
                      class="form-input"
                      type="email"
                      name="email"
                      required
                      aria-required="true"
                      inputmode="email"
                    />
                  </div>
                </div>

                <!-- Emergência -->
                <div class="form-row">
                  <div class="form-field">
                    <label for="nomeEmergencia" class="form-label">
                      Contato de emergência <span class="required">*</span>
                    </label>
                    <input
                      id="nomeEmergencia"
                      class="form-input capitalize-input"
                      type="text"
                      name="nomeEmergencia"
                      required
                      aria-required="true"
                    />
                  </div>

                  <div class="form-field">
                    <label for="vinculo" class="form-label">
                      Vínculo <span class="required">*</span>
                    </label>
                    <select
                      id="vinculo"
                      name="vinculo"
                      class="form-select"
                      required
                      aria-required="true"
                    >
                      <option value="" disabled selected>Selecione</option>
                      {% for value, label in vinculo_choices %}
                      <option value="{{ value }}">{{ label }}</option>
                      {% endfor %}
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="telEmergencia" class="form-label">
                      Telefone de emergência <span class="required">*</span>
                    </label>
                    <input
                      id="telEmergencia"
                      class="form-input phone-mask"
                      type="text"
                      name="telEmergencia"
                      required
                      aria-required="true"
                      inputmode="tel"
                    />
                  </div>
                </div>
              </div>

              <div class="form-navigation">
                <button
                  type="button"
                  class="btn btn-prev"
                  aria-controls="step-1"
                >
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M19 12H5M5 12L12 19M5 12L12 5"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  Voltar
                </button>

                <button type="submit" class="btn btn-submit" id="submitBtn">
                  <span class="btn-text">Enviar Cadastro</span>
                  <span class="btn-loading hidden">
                    <svg class="spinner" viewBox="0 0 50 50">
                      <circle
                        class="path"
                        cx="25"
                        cy="25"
                        r="20"
                        fill="none"
                        stroke-width="5"
                      ></circle>
                    </svg>
                  </span>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="container">
        <p class="footer-text">
          © <span id="current-year"></span> Ponto de Equilíbrio. Todos os direitos reservados.
        </p>
      </div>
    </footer>

    <!-- Modal de Sucesso -->
    <div id="successModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-icon">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.709 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18457 2.99721 7.13633 4.39828 5.49707C5.79935 3.85782 7.69279 2.71538 9.79619 2.24015C11.8996 1.76491 14.1003 1.98234 16.07 2.86"
              stroke="#7F4396"
              stroke-width="2"
              stroke-linecap="round"
            />
            <path
              d="M22 4L12 14.01L9 11.01"
              stroke="#7F4396"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <h3 class="modal-title">Cadastro realizado com sucesso!</h3>
        <p class="modal-message">
          Em breve entraremos em contato para confirmar seus dados.
        </p>
        <button type="button" class="btn btn-modal-close" id="modalCloseBtn">
          Fechar
        </button>
      </div>
    </div>

    {% block scripts %}
<script type="module" src="{% static 'core/js/pacientes/main.js' %}"></script>
      <script src="https://unpkg.com/imask"></script>
    <script src="{% static '/core/js/base/MaskAndInputsBase.js' %}"></script>
    <script src="{% static '/core/js/base/validadorCpfCnpj.js' %}"></script>
    <script src="{% static '/core/js/base/cep.js' %}"></script>
    <script src="{% static '/core/js/pacientes/base.js' %}"></script>
    {% endblock %}
  </body>
</html>
