{% extends 'core/base.html' %}
{% load static %}

{% block title %}Link de PrÃ©-Cadastro{% endblock %}
{% block topbar_title %}Link de PrÃ©-Cadastro{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/pacientes/link_gerado.css' %}">
<link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
{% endblock %}

{% block content %}
<div class="content">
  <div class="right_content">

    <h2><i class='bx bx-link-alt'></i> Link de PrÃ©-Cadastro</h2>

    <div class="steps">
      <p>ğŸ“‹ <strong>Passo 1:</strong> Copie o link ou use os botÃµes abaixo</p>
      <p>ğŸ“¤ <strong>Passo 2:</strong> Envie por WhatsApp ou outro canal</p>
      <p>ğŸ“± <strong>Passo 3:</strong> O paciente preenche no celular</p>
    </div>

    <div class="right_link">
      <div class="right_link-link">
        <input type="text" id="link" value="{{ link_tokenizado }}" readonly>
        <button onclick="copiarLink()" class="btn-save">
          <i class='bx bx-copy'></i>
        </button>
      </div>

      <div class="social-buttons">
        <button onclick="enviarWhatsapp()"><i class='bx bxl-whatsapp'></i></button>
        <button onclick="window.open('https://telegram.me/share/url?url=' + encodeURIComponent(link))"><i class='bx bxl-telegram'></i></button>
        <button onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(link))"><i class='bx bxl-facebook'></i></button>
        <button><i class='bx bxl-instagram'></i></button> <!-- Apenas visual, pois o Instagram nÃ£o aceita links -->
      </div>
    </div>

    <p>Ou leia o QR Code</p>
    <img src="data:image/png;base64,{{ qrcode_base64 }}" alt="QR Code do Link">

    <p style="color:#888; font-size:13px; margin-top:20px;">
      ğŸ’¡ O preenchimento pode ser feito no consultÃ³rio ou de casa.  
      Em caso de dÃºvidas, a recepÃ§Ã£o estÃ¡ Ã  disposiÃ§Ã£o.
    </p>
  </div>
  <div class="left_content">
    <table>
      
    </table>
  </div>
</div>

<div id="copiado" class="toast">âœ… Link copiado com sucesso!</div>

<script>
  const link = document.getElementById("link").value;

  function copiarLink() {
    navigator.clipboard.writeText(link);
    const toast = document.getElementById("copiado");
    toast.style.display = 'block';
    setTimeout(() => toast.style.display = 'none', 3000);
  }

  function enviarWhatsapp() {
    const mensagem = `OlÃ¡! Para agilizar seu atendimento, preencha o formulÃ¡rio: ${encodeURIComponent(link)}`;
    window.open(`https://wa.me/?text=${mensagem}`, "_blank");
  }
</script>
{% endblock %}
