{% load static %}

<!DOCTYPE html>


<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
    <title>üìä Relat√≥rio de Produtividade ‚Äì Por Profissional (Mensal)</title>
    <!-- Font Inter e √≠cones -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   <link rel="stylesheet" href="{% static 'core/css/administrativo/produtividade.css' %}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
</head>
<body>
    <div class="dashboard">

        <!-- üîπ 1Ô∏è‚É£ Filtro Superior (Tema roxo) -->
        <div class="filters-card">
            <div class="filters-group">
                <div class="filter-item">
                    <label><i class="fas fa-user-md"></i> Profissional</label>
                    <select class="filter-select" id="profissionalSelect">
                        <option value="">Selecione...</option>
                        {% for p in profissionais %}
                            <option value="{{ p.id }}" data-setor="{{ p.setor }}">
                                {{ p.nome }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-item">
                    <label><i class="fas fa-calendar"></i> M√™s</label>
                    <select class="filter-select" id="mesSelect">
  
                    </select>
                </div>
                <div class="filter-item">
                    <label><i class="fas fa-calendar-alt"></i> Ano</label>
                    <select class="filter-select" id="anoSelect">
 
                    </select>
                </div>
                <button class="btn btn-primary" id="carregarBtn" onclick="carregarProdutividade()"><i class="fas fa-sync-alt"></i> Carregar relat√≥rio</button>
                <button class="btn btn-outline" id="salvarBtn"><i class="fas fa-save"></i> Salvar altera√ß√µes</button>
            </div>
            <span class="badge-sector" id="setorBadge"><i class="fas fa-stethoscope"></i> Setor: Fisioterapeutas</span>
        </div>

        <!-- Grid principal: tabela TRANSPOSTA com 30 DIAS + painel -->
        <div class="main-grid">
            <!-- üîπ 2Ô∏è‚É£ TABELA MENSAL - DIAS EM LINHA / DADOS EM COLUNA (30 DIAS COMPLETOS) -->
            <div class="table-section">
                <div class="table-header-title">
                    <i class="fas fa-clipboard-list" style="font-size: 1.2rem;"></i>
                    <span style="font-weight: 700; font-size: 0.95rem; color: var(--roxoPrincipal-hover2);" id="tituloRelatorio">Fevereiro 2025 ¬∑ Dra. Carla Mendes</span>
                    <span class="badge-simples"><i class="fas fa-clock"></i> Horas em HH:MM</span>
                </div>
                <div style="overflow-x: auto; padding: 0 4px; max-height: 2000px; overflow-y: auto;">
                <table class="prod-table" id="tabelaProdutividade">
                    <thead>
                        <tr>
                            <th style="position: sticky; left:0; top:0; background:#f1e6f5; z-index:3;">Dia</th>
                            <th style="min-width:110px;">Tipo de Dia</th>
                            <th style="min-width:100px;">Presen√ßa</th>
                            <th style="min-width:90px;">Horas Previstas</th>
                            <th style="min-width:90px;">Atend. Individual</th>
                            <th style="min-width:90px;">Atend. Conjunto</th>
                            <th style="min-width:70px;">Avalia√ß√µes</th>
                            <th style="min-width:70px;">Evolu√ß√µes</th>
                            <th style="min-width:80px;">Prontu√°rios</th>
                            <th style="min-width:90px;">H. Prontu√°rio</th>
                            <th style="min-width:90px;">H. Coordena√ß√£o</th>
                            <th style="min-width:90px;">H. Burocr√°ticas</th>
                            <th style="min-width:90px;">Total Dia</th>
                            <th style="min-width:100px;">Saldo Dia</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyDias">
                        <!-- Os 30 dias ser√£o gerados via JavaScript -->
                    </tbody>
                    <tfoot>
                        <tr class="total-row" id="rowTotalMensal">
                            <td class="row-day-label" style="background:#e6d3ee;"><strong>TOTAL M√äS</strong></td>
                            <td>‚Äî</td>
                            <td>‚Äî</td>
                            <td id="totalPrevistas">00:00</td>
                            <td id="totalIndividual">00:00</td>
                            <td id="totalConjunto">00:00</td>
                            <td id="totalAvaliacoes">0</td>
                            <td id="totalEvolucoes">0</td>
                            <td id="totalProntuariosQtd">0</td>
                            <td id="totalHProntuario">00:00</td>
                            <td id="totalHCoord">00:00</td>
                            <td id="totalHBuro">00:00</td>
                            <td id="totalTrabalhado">00:00</td>
                            <td id="totalSaldo"><span class="saldo-zero">00:00</span></td>
                        </tr>
                    </tfoot>
                </table>
                </div>
                <div class="info-hint"><i class="fas fa-info-circle"></i> Campos edit√°veis: horas previstas, prontu√°rio, coordena√ß√£o, burocr√°tico. Os c√°lculos s√£o autom√°ticos.</div>
            </div>

            <!-- üîπ 3Ô∏è‚É£ PAINEL LATERAL ‚Äì RESUMO GERAL (ATUALIZADO DINAMICAMENTE) -->
            <div class="side-panel">
                <!-- BLOCO A ‚Äì DIAS -->
                <div class="resumo-card">
                    <h3><i class="fas fa-calendar-check"></i> DIAS</h3>
                    <div class="metric-item"><span class="metric-label">Previstos:</span><span class="metric-value" id="diasPrevistosValor">0 (100%)</span></div>
                    <div class="metric-item"><span class="metric-label">Cumpridos:</span><span class="metric-value" id="diasCumpridosValor">0 <span class="badge-percent" id="diasCumpridosPercent">0%</span></span></div>
                </div>
                <!-- BLOCO B ‚Äì HORAS -->
                <div class="resumo-card">
                    <h3><i class="fas fa-hourglass-half"></i> HORAS</h3>
                    <div class="metric-item"><span class="metric-label">Previstas (100%):</span><span class="metric-value" id="horasPrevistasValor">00:00</span></div>
                    <div class="metric-item"><span class="metric-label">Trabalhadas:</span><span class="metric-value" id="horasTrabalhadasValor">00:00 <span class="badge-percent" id="horasPercent">0%</span></span></div>
                </div>
                <!-- BLOCO C ‚Äì Distribui√ß√£o + Gr√°fico -->
                <div class="resumo-card">
                    <h3><i class="fas fa-chart-pie"></i> DISTRIBUI√á√ÉO</h3>
                    <div class="distrib-list" id="distribuicaoList">
                        <div class="distrib-item"><span>Atend. individual</span> <span><strong id="distribIndividual">00:00</strong> <span class="porcentagem" id="percIndividual">0%</span></span></div>
                        <div class="distrib-item"><span>Atend. conjunto</span> <span><strong id="distribConjunto">00:00</strong> <span class="porcentagem" id="percConjunto">0%</span></span></div>
                        <div class="distrib-item"><span>Prontu√°rio</span> <span><strong id="distribProntuario">00:00</strong> <span class="porcentagem" id="percProntuario">0%</span></span></div>
                        <div class="distrib-item"><span>Coordena√ß√£o</span> <span><strong id="distribCoord">00:00</strong> <span class="porcentagem" id="percCoord">0%</span></span></div>
                        <div class="distrib-item"><span>Burocr√°tico</span> <span><strong id="distribBuro">00:00</strong> <span class="porcentagem" id="percBuro">0%</span></span></div>
                    </div>
                    <!-- Gr√°fico de pizza -->
                    <div class="chart-container">
                        <canvas id="horasChart" style="width:100%; height:160px;"></canvas>
                    </div>
                </div>
                <!-- BLOCO D ‚Äì Prontu√°rios + raz√£o -->
                <div class="resumo-card">
                    <h3><i class="fas fa-file-medical"></i> PRONTU√ÅRIOS</h3>
                    <div class="metric-item"><span class="metric-label">Total prontu√°rios:</span><span class="metric-value" id="prontuariosTotal">0</span></div>
                    <div class="metric-item"><span class="metric-label">Horas de prontu√°rio:</span><span class="metric-value" id="prontuariosHoras">00:00</span></div>
                    <div class="ratio-box">
                        <span style="font-weight: 800; color: var(--roxoPrincipal-hover2);">‚ö° Raz√£o produtividade</span><br>
                        <span style="font-size: 1.4rem; font-weight: 900; color: var(--roxoPrincipal);" id="razaoProntuario">0,00</span> <span style="font-size:0.8rem; color: var(--roxoPrincipal-hover2);">pront./hora</span>
                        <div style="font-size:0.7rem; color: var(--cinza-escuro);" id="razaoDetalhe">(0 pront √∑ 0h)</div>
                    </div>
                </div>
                <!-- BLOCO E ‚Äì Indicadores autom√°ticos -->
                <div class="resumo-card">
                    <h3><i class="fas fa-chart-line"></i> INDICADORES</h3>
                    <div class="metric-item"><span class="metric-label">Total avalia√ß√µes:</span><span class="metric-value" id="totalAvaliacoesInd">0</span></div>
                    <div class="metric-item"><span class="metric-label">Total evolu√ß√µes:</span><span class="metric-value" id="totalEvolucoesInd">0</span></div>
                </div>
                <!-- BLOCO F ‚Äì Saldo Final -->
                <div class="resumo-card" style="background: var(--roxoPrincipal-hover); border: 2px solid var(--roxoPrincipal);">
                    <h3 style="color: var(--roxoPrincipal-hover2);"><i class="fas fa-flag-checkered"></i> SALDO FINAL</h3>
                    <div style="display: flex; justify-content: space-between; align-items: baseline;">
                        <span style="font-size: 1.3rem; font-weight: 900;" id="saldoFinalValor">00:00</span>
                        <span class="badge-percent" style="font-weight: 800;" id="saldoFinalPercent">0%</span>
                    </div>
                    <div style="font-size:0.8rem; color: var(--roxoPrincipal-hover2); margin-top: 4px;">Horas trabalhadas ‚Äì Previstas</div>
                </div>
            </div>
        </div>
    </div>

<script src="{% static 'core/js/administrativo/prodBase.js' %}"></script>
</body>
</html>