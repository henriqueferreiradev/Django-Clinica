{% extends 'core/base.html' %}
{% load static %}

{% block title %}Documentos - Ponto de Equilíbrio{% endblock %}

{% block extra_css %}

<link rel="stylesheet" href="{% static 'core/css/administrativo/documentos.css' %}">
<link rel="stylesheet" href="{% static 'core/css/tema.css' %}">

{% endblock %}

{% block topbar_title %}Documentos{% endblock %}

{% block content %}

    <main class="content">
                    <button class="btn-primary" id="openModalBtn">
                <i class="fas fa-plus"></i> Enviar Documento
            </button>
        <div class="docs-info">
            <div class="info-card">
                <h3>Total de Documentos</h3>
                <div class="count" id="totalDocs">{{ todos_documentos_count }}</div>
            </div>
            <div class="info-card warning">
                <h3>Vencidos</h3>
                <div class="count" id="expiredDocs">{{ todos_documentos_vencidos }}</div>
            </div>
            <div class="info-card alerts">
                <h3>Próximos do Vencimento</h3>
                <div class="count" id="warningDocs">{{ todos_documentos_proximos }}</div>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Nome do Documento</th>
                        <th>Data de Envio</th>
                        <th>Validade</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="documentsTableBody">
                    {% if lista_documentos %}
                    {% for documento in todos_documentos %}
                        <tr>
                            <td>{{ documento.nome }}</td>
                            <td>{{ documento.criado_em|date:"d/m/Y" }}</td>
                            <td>{% if not documento.status_calculado %} - {% else %} {{ documento.validade|date:"d/m/Y" }} {% endif %}</td>
                            <td>
                                <span class="status-badge
                                    {% if documento.status_calculado == 'vencido' %} status-expired
                                    {% elif documento.status_calculado == 'vencimento_proximo' %} status-warning
                                    {% elif documento.status_calculado == 'valido' %} status-valid
                                    {% elif documento.status_calculado == 'sem_vencimento' %} status-no-expiry
                                    {% endif %}">
                                    {% if documento.status_calculado == 'vencido' %} Vencido
                                    {% elif documento.status_calculado == 'vencimento_proximo' %} Vencimento Próximo
                                    {% elif documento.status_calculado == 'valido' %} Válido
                                    {% elif documento.status_calculado == 'sem_vencimento' %} Sem Validade
                                    {% endif %}
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                {% if documento.arquivo %}
                                    <a class="action-btn resolve" href="{{ documento.arquivo.url }}" target="_blank" rel="noopener">
                                    <i class="fa-solid fa-eye"></i>
                                    </a>
                                    <a class="action-btn cancel" href="{{ documento.arquivo.url }}" download>
                                    <i class="fa-solid fa-download"></i>
                                    </a>
                                {% else %}
                                    <span class="file-empty-msg">
                                    <i class="fa-solid fa-triangle-exclamation"></i>
                                    Arquivo não anexado
                                    </span>
                                {% endif %}
                                </div>
                            </td>
                        </tr>   
                    {% endfor %}
                    {% else %}
                        <tr id="emptyRow" style="display: none;">
                            <td colspan="6">
                                <div class="empty-state">
                                    <i class="fas fa-folder-open"></i>
                                    <h3>Nenhum documento cadastrado</h3>
                                    <p>Clique em "Enviar Documento" para adicionar seu primeiro documento.</p>
                                </div>
                            </td>
                        </tr>
                    
                    {% endif %}
                    
                </tbody>
            </table>
        </div>
    </main>

    <!-- Modal para envio de documentos -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-cloud-upload-alt"></i> Enviar Documento</h2>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="documentForm">
                    
                    <div class="form-group">
                        <label for="docType">Tipo do Documento</label>
                        <select name="docType" id="docType" required>
                            <option value="">Selecione um tipo</option>
                            {% for documento in lista_documentos %}
                                <option
                                    value="{{ documento.id }}"
                                    data-exige-validade="{{ documento.exige_validade|yesno:'1,0' }}"
                                >
                                    {{ documento.tipo_documento }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="docExpiry">Validade do Documento</label>
                        <input type="date" id="docExpiry" name='docExpiry'>
                        <p class="help-text">Caso o documento possua validade, informe a data de expiração</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="fileUpload">Upload do Arquivo *</label>
                        <div class="file-upload" id="fileUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Clique para selecionar ou arraste o arquivo</p>
                            <p class="help-text">Formatos aceitos: PDF, JPG, PNG (Tamanho máximo: 10MB)</p>
                            <input type="file" id="fileInput" name='docImg' accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                        </div>
                        <div class="file-name" id="fileName"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="docNotes">Observações</label>
                        <textarea id="docNotes" name='docNotes' rows="3" placeholder="Adicione observações ou informações adicionais sobre este documento..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelBtn">Cancelar</button>
                <button class="btn-primary" id="saveDocBtn">Salvar Documento</button>
            </div>
        </div>
    </div>

 
{% include "core/partials/alertas.html" %}
{% endblock %}

{% block scripts %}
<script src="{% static '/core/js/administrativo/docBase.js' %}"></script>
 
{% endblock %}