{% extends 'core/base.html' %}
{% load static %}
{% block title %}Contas a Pagar - Sistema{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/financeiro/contas_pagar.css' %}">
<link rel="stylesheet" href="{% static 'core/css/tema.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

 
{% endblock %}

{% block topbar_title %}<span>Contas a Pagar</span>{% endblock %}

{% block content %}
{% include "core/partials/_confirm_modal.html" %}

<div class="content">

  <!-- Cabeçalho + Filtros -->
  <div class="layout-bar">
    <h2 class="receber-title" style="display:flex;align-items:center;gap:.6rem;margin:0;color:var(--titulo-perfil);font-size:1.4rem">
      <i class="fa-solid fa-credit-card" style="color:var(--roxoPrincipal)"></i> Contas a Pagar
    </h2>
    <div class="layout-actions">
      <button class="btn btn-primary" id="openModalNovaDespesa">
        <i class="fa-solid fa-plus-circle"></i> Nova Despesa
      </button>
      <button class="btn btn-outline" id="btnPrint">
        <i class="fa-solid fa-print"></i> Imprimir
      </button>
    </div>
  </div>

  <div class="filtros-container">
    <div class="filtros-grid">
      <div class="filtro-group">
        <label class="filtro-label">Status</label>
        <select class="filtro-select">
          <option value="">Todos</option>
          <option value="pendente">Pendentes</option>
          <option value="atrasado">Atrasados</option>
          <option value="pago">Pagas</option>
          <option value="agendado">Agendadas</option>
        </select>
      </div>
      <div class="filtro-group">
        <label class="filtro-label">Vencimento</label>
        <select class="filtro-select">
          <option value="">Todos</option>
          <option value="hoje">Vence hoje</option>
          <option value="semana">Esta semana</option>
          <option value="mes">Este mês</option>
          <option value="atrasado">Atrasados</option>
        </select>
      </div>
      <div class="filtro-group">
        <label class="filtro-label">Fornecedor</label>
        <input type="text" class="filtro-input" placeholder="Filtrar por fornecedor">
      </div>
      <div class="filtro-group" style="align-self:end;">
        <button class="filtro-button"><i class="fa-solid fa-filter"></i> Filtrar</button>
      </div>
    </div>
  </div>

  <!-- Resumo -->
  <div class="resumo-grid">
    <div class="resumo-card">
      <div>
        <div class="resumo-titulo">A Pagar (Total)</div>
        <div class="resumo-valor">R$ 15.230,00</div>
      </div>
      <i class="fa-solid fa-credit-card resumo-icon"></i>
    </div>
    <div class="resumo-card">
      <div>
        <div class="resumo-titulo">Atrasados</div>
        <div class="resumo-valor valor-atrasado">R$ 3.420,00</div>
      </div>
      <i class="fa-solid fa-triangle-exclamation resumo-icon valor-atrasado"></i>
    </div>
    <div class="resumo-card">
      <div>
        <div class="resumo-titulo">Vencem Hoje</div>
        <div class="resumo-valor valor-hoje">R$ 2.150,00</div>
      </div>
      <i class="fa-solid fa-calendar-day resumo-icon" style="color:#f39c12"></i>
    </div>
    <div class="resumo-card">
      <div>
        <div class="resumo-titulo">Agendados</div>
        <div class="resumo-valor valor-info">R$ 5.800,00</div>
      </div>
      <i class="fa-solid fa-calendar-check resumo-icon"></i>
    </div>
  </div>

  <!-- Tabela -->
  <div class="tabela-container">
    <div class="tabela-header">
      <h3 class="tabela-titulo">Lançamentos</h3>
      <div class="tabela-acoes">
        <button class="btn btn-outline btn-sm"><i class="fa-solid fa-download"></i> Exportar</button>
        <div class="dropdown">
          <button class="btn btn-outline btn-sm dropdown-toggle"><i class="fa-solid fa-list-check"></i> Ações em Lote</button>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item"><i class="fa-solid fa-circle-check"></i> Marcar como Pago</a>
            <a href="#" class="dropdown-item"><i class="fa-solid fa-calendar"></i> Agendar Pagamento</a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item"><i class="fa-solid fa-file-pdf"></i> Gerar Remessas</a>
          </div>
        </div>
      </div>
    </div>

    <div class="tabela-scroll">
      <table class="tabela">
        <thead>
          <tr>
            <th width="40"><input type="checkbox" class="form-check-input"></th>
            <th>Vencimento</th>
            <th>Fornecedor</th>
            <th>Descrição</th>
            <th>Categoria</th>
            <th class="text-right">Valor</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <!-- Atrasado -->
          <tr class="status-atrasado">
            <td><input type="checkbox" class="form-check-input"></td>
            <td class="valor-atrasado">05/05/2023</td>
            <td>Aluguel do Prédio</td>
            <td>Aluguel Maio/2023</td>
            <td><span class="badge badge-secundario">Aluguel</span></td>
            <td class="text-right valor-atrasado">R$ 5.000,00</td>
            <td><span class="badge badge-atrasado">Atrasado</span></td>
            <td>
              <button class="btn btn-success btn-sm" title="Registrar Pagamento"><i class="fa-solid fa-money-bill"></i></button>
              <button class="btn btn-outline btn-sm" title="Editar"><i class="fa-solid fa-pencil"></i></button>
              <button class="btn btn-outline btn-sm" title="Detalhes"><i class="fa-solid fa-eye"></i></button>
            </td>
          </tr>

          <!-- Atrasado -->
          <tr class="status-atrasado">
            <td><input type="checkbox" class="form-check-input"></td>
            <td class="valor-atrasado">10/05/2023</td>
            <td>Energia Elétrica</td>
            <td>Fatura Abril/2023</td>
            <td><span class="badge" style="background: var(--roxoPrincipal); color: var(--branco);">Energia</span></td>
            <td class="text-right valor-atrasado">R$ 850,00</td>
            <td><span class="badge badge-atrasado">Atrasado</span></td>
            <td>
              <button class="btn btn-success btn-sm" title="Registrar Pagamento"><i class="fa-solid fa-money-bill"></i></button>
              <button class="btn btn-outline btn-sm" title="Editar"><i class="fa-solid fa-pencil"></i></button>
              <button class="btn btn-outline btn-sm" title="Detalhes"><i class="fa-solid fa-eye"></i></button>
            </td>
          </tr>

          <!-- Vence hoje -->
          <tr class="status-pendente">
            <td><input type="checkbox" class="form-check-input"></td>
            <td class="valor-hoje">16/05/2023</td>
            <td>Água e Esgoto</td>
            <td>Fatura Maio/2023</td>
            <td><span class="badge badge-secundario">Água</span></td>
            <td class="text-right valor-hoje">R$ 320,00</td>
            <td><span class="badge badge-pendente">Pendente</span></td>
            <td>
              <button class="btn btn-success btn-sm" title="Registrar Pagamento"><i class="fa-solid fa-money-bill"></i></button>
              <button class="btn btn-outline btn-sm" title="Editar"><i class="fa-solid fa-pencil"></i></button>
              <button class="btn btn-outline btn-sm" title="Detalhes"><i class="fa-solid fa-eye"></i></button>
            </td>
          </tr>

          <!-- Vence hoje -->
          <tr class="status-pendente">
            <td><input type="checkbox" class="form-check-input"></td>
            <td class="valor-hoje">16/05/2023</td>
            <td>Limpeza Profissional</td>
            <td>Serviço Quinzenal</td>
            <td><span class="badge" style="background: var(--verdePrincipal); color: var(--branco);">Limpeza</span></td>
            <td class="text-right valor-hoje">R$ 450,00</td>
            <td><span class="badge badge-pendente">Pendente</span></td>
            <td>
              <button class="btn btn-success btn-sm" title="Registrar Pagamento"><i class="fa-solid fa-money-bill"></i></button>
              <button class="btn btn-outline btn-sm" title="Editar"><i class="fa-solid fa-pencil"></i></button>
              <button class="btn btn-outline btn-sm" title="Detalhes"><i class="fa-solid fa-eye"></i></button>
            </td>
          </tr>

          <!-- Futuro -->
          <tr class="status-pendente">
            <td><input type="checkbox" class="form-check-input"></td>
            <td class="valor-futuro">20/05/2023</td>
            <td>Internet</td>
            <td>Fatura Maio/2023</td>
            <td><span class="badge badge-escuro">Internet</span></td>
            <td class="text-right valor-futuro">R$ 220,00</td>
            <td><span class="badge badge-pendente">Pendente</span></td>
            <td>
              <button class="btn btn-success btn-sm" title="Registrar Pagamento"><i class="fa-solid fa-money-bill"></i></button>
              <button class="btn btn-outline btn-sm" title="Editar"><i class="fa-solid fa-pencil"></i></button>
              <button class="btn btn-outline btn-sm" title="Detalhes"><i class="fa-solid fa-eye"></i></button>
            </td>
          </tr>

          <!-- Agendado -->
          <tr class="status-agendado">
            <td><input type="checkbox" class="form-check-input"></td>
            <td>25/05/2023</td>
            <td>Folha de Pagamento</td>
            <td>Salários Maio/2023</td>
            <td><span class="badge" style="background:#ffe5e8;color:#b4232a">Folha</span></td>
            <td class="text-right">R$ 5.800,00</td>
            <td><span class="badge" style="background: var(--roxoPrincipal); color: var(--branco);">Agendado</span></td>
            <td>
              <button class="btn btn-outline btn-sm" title="Editar"><i class="fa-solid fa-pencil"></i></button>
              <button class="btn btn-outline btn-sm" title="Detalhes"><i class="fa-solid fa-eye"></i></button>
            </td>
          </tr>

          <!-- Pago -->
          <tr class="status-pago">
            <td><input type="checkbox" class="form-check-input" disabled></td>
            <td>01/05/2023</td>
            <td>Telefone</td>
            <td>Fatura Abril/2023</td>
            <td><span class="badge badge-secundario">Telefone</span></td>
            <td class="text-right">R$ 180,00</td>
            <td><span class="badge badge-pago">Pago</span></td>
            <td>
              <button class="btn btn-outline btn-sm" title="Ver Comprovante"><i class="fa-solid fa-receipt"></i></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginação -->
    <div class="paginacao">
      <ul class="paginacao-list">
        <li class="paginacao-item disabled"><a href="#" class="paginacao-link">Anterior</a></li>
        <li class="paginacao-item active"><a href="#" class="paginacao-link">1</a></li>
        <li class="paginacao-item"><a href="#" class="paginacao-link">2</a></li>
        <li class="paginacao-item"><a href="#" class="paginacao-link">3</a></li>
        <li class="paginacao-item"><a href="#" class="paginacao-link">Próxima</a></li>
      </ul>
    </div>
  </div>

</div>

<!-- Modal Pagamento -->
<div class="modal-overlay" id="modalPagamento">
  <div class="modal-container">
    <div class="modal-header">
      <h3 class="modal-title"><i class="fa-solid fa-money-bill"></i> Registrar Pagamento</h3>
      <button class="modal-close" id="closePaymentModal">&times;</button>
    </div>
    <div class="modal-body">
      <form id="formPagamento">
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Fornecedor</label>
              <input type="text" class="form-control" value="Aluguel do Prédio" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">Descrição</label>
              <input type="text" class="form-control" value="Aluguel Maio/2023" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">Valor Original</label>
              <input type="text" class="form-control" value="R$ 5.000,00" readonly>
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Data do Pagamento</label>
              <input type="date" class="form-control" value="2023-05-16" required>
            </div>
            <div class="form-group">
              <label class="form-label">Forma de Pagamento</label>
              <select class="form-select" required>
                <option value="ted">TED/DOC</option>
                <option value="boleto">Boleto</option>
                <option value="cheque">Cheque</option>
                <option value="dinheiro">Dinheiro</option>
                <option value="debito">Cartão Débito</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Valor Pago</label>
              <div style="display:flex;gap:.5rem;">
                <span class="form-control" style="flex:0 0 64px;text-align:center;">R$</span>
                <input type="text" class="form-control" value="5.000,00" required>
              </div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Conta Bancária</label>
              <select class="form-select">
                <option>Banco ABC - CC 12345-6</option>
                <option>Banco XYZ - CC 98765-4</option>
              </select>
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Nº Documento</label>
              <input type="text" class="form-control" placeholder="Número do documento">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Observações</label>
          <textarea class="form-control" rows="2"></textarea>
        </div>

        <div class="form-group">
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="anexarComprovante">
            <label class="form-check-label" for="anexarComprovante">Anexar comprovante</label>
          </div>
        </div>

        <div class="form-group" id="comprovanteField" style="display:none;">
          <label class="form-label">Comprovante</label>
          <input type="file" class="form-control">
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" id="cancelPaymentModal">Cancelar</button>
      <button class="btn btn-primary" id="savePagamento"><i class="fa-solid fa-check-circle"></i> Registrar Pagamento</button>
    </div>
  </div>
</div>

<!-- Modal Nova Despesa -->
<div class="modal-overlay" id="modalNovaDespesa">
  <div class="modal-container">
    <div class="modal-header">
      <h3 class="modal-title"><i class="fa-solid fa-plus-circle"></i> Nova Despesa</h3>
      <button class="modal-close" id="closeNovaDespesa">&times;</button>
    </div>
    <div class="modal-body">
      <form id="formNovaDespesa">
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Fornecedor</label>
              <select class="form-select" required>
                <option value="">Selecione um fornecedor</option>
                <option value="1">Aluguel do Prédio</option>
                <option value="2">Energia Elétrica</option>
                <option value="3">Água e Esgoto</option>
                <option value="4">Limpeza Profissional</option>
                <option value="5">Internet</option>
                <option value="6">Folha de Pagamento</option>
                <option value="7">Telefone</option>
              </select>
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Categoria</label>
              <select class="form-select" required>
                <option value="">Selecione uma categoria</option>
                <option value="aluguel">Aluguel</option>
                <option value="energia">Energia</option>
                <option value="agua">Água</option>
                <option value="limpeza">Limpeza</option>
                <option value="internet">Internet</option>
                <option value="folha">Folha de Pagamento</option>
                <option value="telefone">Telefone</option>
                <option value="outros">Outros</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Descrição</label>
          <input type="text" class="form-control" placeholder="Descrição da despesa" required>
        </div>

        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Data de Vencimento</label>
              <input type="date" class="form-control" required>
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Valor</label>
              <div style="display:flex;gap:.5rem;">
                <span class="form-control" style="flex:0 0 64px;text-align:center;">R$</span>
                <input type="text" class="form-control" placeholder="0,00" required>
              </div>
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Status</label>
              <select class="form-select" required>
                <option value="pendente">Pendente</option>
                <option value="agendado">Agendado</option>
                <option value="pago">Pago</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Forma de Pagamento</label>
              <select class="form-select" required>
                <option value="">Selecione</option>
                <option value="ted">TED/DOC</option>
                <option value="boleto">Boleto</option>
                <option value="cheque">Cheque</option>
                <option value="dinheiro">Dinheiro</option>
                <option value="debito">Cartão Débito</option>
                <option value="credito">Cartão Crédito</option>
              </select>
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Conta Bancária</label>
              <select class="form-select" required>
                <option value="">Selecione</option>
                <option>Banco ABC - CC 12345-6</option>
                <option>Banco XYZ - CC 98765-4</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Observações</label>
          <textarea class="form-control" rows="3" placeholder="Observações sobre esta despesa"></textarea>
        </div>

        <div class="form-group">
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="despesaRecorrente">
            <label class="form-check-label" for="despesaRecorrente">Despesa Recorrente</label>
          </div>
        </div>

        <div class="form-row" id="recorrenciaFields" style="display:none;">
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Frequência</label>
              <select class="form-select">
                <option value="mensal">Mensal</option>
                <option value="bimestral">Bimestral</option>
                <option value="trimestral">Trimestral</option>
                <option value="semestral">Semestral</option>
                <option value="anual">Anual</option>
              </select>
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Início</label>
              <input type="date" class="form-control">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label class="form-label">Término</label>
              <input type="date" class="form-control">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Anexar Documento</label>
          <input type="file" class="form-control">
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" id="cancelNovaDespesa">Cancelar</button>
      <button class="btn btn-primary" id="saveNovaDespesa"><i class="fa-solid fa-save"></i> Salvar Despesa</button>
    </div>
  </div>
</div>

{% include "core/partials/alertas.html" %}
{% endblock %}

{% block scripts %}
<script>
  // ===== Dropdown (padrão Receber) =====
  document.addEventListener('click', function(e){
    const toggle = e.target.closest('.dropdown-toggle');
    const openMenus = document.querySelectorAll('.dropdown-menu.show');
    if (toggle){
      e.preventDefault();
      const menu = toggle.parentElement.querySelector('.dropdown-menu');
      if (menu) menu.classList.toggle('show');
      // fecha outros
      openMenus.forEach(m => { if (m !== menu) m.classList.remove('show'); });
    } else {
      openMenus.forEach(m => m.classList.remove('show'));
    }
  });

  // ===== Modais (padrão Receber) =====
  const modalPagamento = document.getElementById('modalPagamento');
  const modalNovaDespesa = document.getElementById('modalNovaDespesa');

  document.querySelectorAll('.btn.btn-success').forEach(btn=>{
    btn.addEventListener('click', ()=> modalPagamento.classList.add('active'));
  });
  document.getElementById('openModalNovaDespesa')?.addEventListener('click', ()=> modalNovaDespesa.classList.add('active'));

  // Fechar modais
  document.getElementById('closePaymentModal')?.addEventListener('click', ()=> modalPagamento.classList.remove('active'));
  document.getElementById('cancelPaymentModal')?.addEventListener('click', ()=> modalPagamento.classList.remove('active'));
  document.getElementById('savePagamento')?.addEventListener('click', (e)=>{ e.preventDefault(); modalPagamento.classList.remove('active'); });

  document.getElementById('closeNovaDespesa')?.addEventListener('click', ()=> modalNovaDespesa.classList.remove('active'));
  document.getElementById('cancelNovaDespesa')?.addEventListener('click', ()=> modalNovaDespesa.classList.remove('active'));
  document.getElementById('saveNovaDespesa')?.addEventListener('click', (e)=>{ e.preventDefault(); modalNovaDespesa.classList.remove('active'); });

  // Fechar clicando fora
  [modalPagamento, modalNovaDespesa].forEach(modal=>{
    modal.addEventListener('click', (e)=>{ if(e.target === modal) modal.classList.remove('active'); });
  });

  // Campos dinâmicos
  const anexar = document.getElementById('anexarComprovante');
  const comp = document.getElementById('comprovanteField');
  if (anexar && comp){
    anexar.addEventListener('change', ()=> comp.style.display = anexar.checked ? 'block' : 'none');
  }

  const chkRec = document.getElementById('despesaRecorrente');
  const recFields = document.getElementById('recorrenciaFields');
  if (chkRec && recFields){
    chkRec.addEventListener('change', ()=> recFields.style.display = chkRec.checked ? 'flex' : 'none');
  }

  // Imprimir
  document.getElementById('btnPrint')?.addEventListener('click', ()=> window.print());
</script>
{% endblock %}
