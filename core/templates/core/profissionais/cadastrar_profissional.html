{% extends 'core/base.html' %}

{% load static %}
{% block title %}Cadastrar Profissional - Ponto de Equilíbrio{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/profissionais/cadastrar_profissional.css' %}">
<link rel="stylesheet" href="{% static 'core/css/pacientes/cadastrar_paciente.css' %}">
<link rel="stylesheet" href="{% static 'core/css/tema.css' %}">
<link rel="stylesheet" href="{% static 'core/css/alerts.css' %}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}


<main id="form-section" class="form-section">
  <div class="container">
    <div class="content">
      <!-- Progress Steps -->
      <div class="form-progress">
        <div class="progress-step active" data-step="1" aria-current="step">
          <span class="step-number">1</span>
          <span class="step-text">Informações Pessoais</span>
        </div>
        <div class="progress-step" data-step="2">
          <span class="step-number">2</span>
          <span class="step-text">Endereço e Contato</span>
        </div>
      </div>

      <form method="post" enctype="multipart/form-data" class="multi-step-form" id="multiStepForm" novalidate>
        {% csrf_token %}

        <!-- ETAPA 1 -->
        <div class="form-step active" id="step-1" role="tabpanel" aria-labelledby="step-1-tab">
          <h2 class="form-step-title">Informações Pessoais</h2>

          <div class="form-step-content">
            <!-- Nome, Sobrenome, Nome Social -->
            <div class="form-row">
              <div class="form-field">
                <label for="nome" class="form-label">
                  Nome <span class="required">*</span>
                </label>
                <input
                  id="nome"
                  class="form-input capitalize-input"
                  type="text"
                  name="nome"
                  required
                  aria-required="true"
                />
              </div>

              <div class="form-field">
                <label for="sobrenome" class="form-label">
                  Sobrenome <span class="required">*</span>
                </label>
                <input
                  id="sobrenome"
                  class="form-input capitalize-input"
                  type="text"
                  name="sobrenome"
                  required
                  aria-required="true"
                />
              </div>

              <div class="form-field">
                <label for="nomeSocial" class="form-label">Nome Social</label>
                <input
                  id="nomeSocial"
                  class="form-input capitalize-input"
                  type="text"
                  name="nomeSocial"
                />
              </div>
            </div>

            <!-- RG, CPF, CNPJ, Nascimento -->
            <div class="form-row">
              <div class="form-field">
                <label for="rg" class="form-label">RG</label>
                <input
                  id="rg"
                  class="form-input"
                  type="text"
                  name="rg"
                  inputmode="numeric"
                />
              </div>

              <div class="form-field">
                <label for="cpf" class="form-label">
                  CPF <span class="required">*</span>
                </label>
                <input
                  id="cpf"
                  class="form-input cpf-mask"
                  type="text"
                  name="cpf"
                  required
                  aria-required="true"
                  inputmode="numeric"
                />
                <span id="cpf-feedback" class="error-message"></span>
              </div>

              <div class="form-field">
                <label for="cnpj" class="form-label">CNPJ</label>
                <input
                  id="cnpj"
                  class="form-input cnpj-mask"
                  type="text"
                  name="cnpj"
                  inputmode="numeric"
                />
              </div>

              <div class="form-field">
                <label for="nascimento" class="form-label">
                  Nascimento <span class="required">*</span>
                </label>
                <input
                  id="nascimento"
                  class="form-input date-mask"
                  type="text"
                  name="nascimento"
                  required
                  aria-required="true"
                  placeholder="DD/MM/AAAA"
                />
              </div>
            </div>

            <!-- Cor, Sexo, Estado Civil -->
            <div class="form-row">
              <div class="form-field">
                <label for="cor" class="form-label">Cor/Raça</label>
                <select id="cor" name="cor" class="form-select">
                  <option value="" disabled selected>Selecione</option>
                  {% for value, label in cor_choices %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="form-field">
                <label for="sexo" class="form-label">Sexo</label>
                <select id="sexo" name="sexo" class="form-select">
                  <option value="" disabled selected>Selecione</option>
                  {% for value, label in sexo_choices %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="form-field">
                <label for="estado_civil" class="form-label">
                  Estado Civil <span class="required">*</span>
                </label>
                <select
                  id="estado_civil"
                  name="estado_civil"
                  class="form-select"
                  required
                  aria-required="true"
                >
                  <option value="" disabled selected>Selecione</option>
                  {% for value, label in estado_civil_choices %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <!-- Naturalidade, UF, Especialidade -->
            <div class="form-row">
              <div class="form-field">
                <label for="naturalidade" class="form-label">
                  Naturalidade <span class="required">*</span>
                </label>
                <input
                  id="naturalidade"
                  class="form-input"
                  type="text"
                  name="naturalidade"
                  required
                  aria-required="true"
                />
              </div>

              <div class="form-field">
                <label for="uf" class="form-label">
                  UF <span class="required">*</span>
                </label>
                <select
                  id="uf"
                  name="uf"
                  class="form-select"
                  required
                  aria-required="true"
                >
                  <option value="" disabled selected>Selecione</option>
                  {% for value, label in uf_choices %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="form-field">
                <label for="especialidade" class="form-label">
                  Especialidade <span class="required">*</span>
                </label>
                <select
                  id="especialidade"
                  name="especialidade"
                  class="form-select"
                  required
                  aria-required="true"
                >
                  <option value="" disabled selected>Selecione</option>
                  {% for esp in especialidade_choices %}
                  <option value="{{ esp.id }}">{{ esp.nome }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <!-- Conselhos Profissionais -->
            <div class="form-row">
              <div class="form-field">
                <label for="conselho1" class="form-label">
                  Conselho Principal <span class="required">*</span>
                </label>
                <select
                  id="conselho1"
                  name="conselho1"
                  class="form-select"
                  required
                  aria-required="true"
                >
                  <option value="" disabled selected>Selecione</option>
                  {% for value, label in conselho_choices %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="form-field">
                <label for="num1_conselho" class="form-label">
                  Nº Conselho <span class="required">*</span>
                </label>
                <input
                  id="num1_conselho"
                  class="form-input"
                  type="text"
                  name="num1_conselho"
                  required
                  aria-required="true"
                />
              </div>
            </div>

            <!-- Conselhos Complementares -->
            <div class="form-row">
              <div class="form-field">
                <label for="conselho2" class="form-label">Conselho Complementar</label>
                <select id="conselho2" name="conselho2" class="form-select">
                  <option value="" disabled selected>Selecione</option>
                  {% for value, label in conselho_choices %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="form-field">
                <label for="num2_conselho" class="form-label">Nº Conselho</label>
                <input
                  id="num2_conselho"
                  class="form-input"
                  type="text"
                  name="num2_conselho"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-field">
                <label for="conselho3" class="form-label">Conselho Complementar</label>
                <select id="conselho3" name="conselho3" class="form-select">
                  <option value="" disabled selected>Selecione</option>
                  {% for value, label in conselho_choices %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="form-field">
                <label for="num3_conselho" class="form-label">Nº Conselho</label>
                <input
                  id="num3_conselho"
                  class="form-input"
                  type="text"
                  name="num3_conselho"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-field">
                <label for="conselho4" class="form-label">Conselho Complementar</label>
                <select id="conselho4" name="conselho4" class="form-select">
                  <option value="" disabled selected>Selecione</option>
                  {% for value, label in conselho_choices %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="form-field">
                <label for="num4_conselho" class="form-label">Nº Conselho</label>
                <input
                  id="num4_conselho"
                  class="form-input"
                  type="text"
                  name="num4_conselho"
                />
              </div>
            </div>

            <!-- Foto + Observação -->
            <div class="form-row">
              <div class="form-field form-field-file">
                <label for="file" class="form-label">Foto (opcional)</label>
                <div class="file-upload-wrapper">
                  <input
                    id="file"
                    name="foto"
                    type="file"
                    accept="image/*"
                    onchange="previewImage(event)"
                    aria-describedby="fileHelp"
                  />
                  <label for="file" class="file-upload-label">
                    <span class="file-upload-icon">
                      <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M12 5V19M5 12H19"
                          stroke="#7F4396"
                          stroke-width="2"
                          stroke-linecap="round"
                        />
                      </svg>
                    </span>
                    <span class="file-upload-text">Selecione uma foto</span>
                  </label>
                  {% if profissional.foto %}
                    <img id="preview" src="{{ profissional.foto.url }}" alt="Foto atual" 
                         class="image-preview" style="display: block;">
                  {% else %}
                    <img id="preview" src="#" alt="Preview da imagem" 
                         class="image-preview" style="display: none;">
                  {% endif %}
                  <small id="fileHelp" class="form-help-text"
                    >Formatos aceitos: JPG, PNG (máx. 2MB)</small
                  >
                </div>
              </div>

              <div class="form-field">
                <label for="observacao" class="form-label">Observação</label>
                <textarea
                  id="observacao"
                  class="form-textarea"
                  name="observacao"
                  maxlength="500"
                  aria-describedby="charCount"
                ></textarea>
                <div id="charCount" class="char-count">
                  <span class="current-count">0</span>/500 caracteres
                </div>
              </div>
            </div>
          </div>

          <div class="form-navigation">
            <button type="button" class="btn btn-next" aria-controls="step-2">
              Próximo
              <svg
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M5 12H19M19 12L12 5M19 12L12 19"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
          </div>
        </div>

        <!-- ETAPA 2 -->
        <div
          class="form-step"
          id="step-2"
          role="tabpanel"
          aria-labelledby="step-2-tab"
        >
          <h2 class="form-step-title">Endereço e Contato</h2>

          <div class="form-step-content">
            <!-- CEP, Rua -->
            <div class="form-row">
              <div class="form-field">
                <label for="cep" class="form-label">
                  CEP <span class="required">*</span>
                </label>
                <input
                  id="cep"
                  class="form-input cep-mask"
                  type="text"
                  name="cep"
                  required
                  aria-required="true"
                  inputmode="numeric"
                />
                <button type="button" class="btn-cep-search" id="btnBuscarCep">
                  Buscar CEP
                </button>
              </div>

              <div class="form-field">
                <label for="rua" class="form-label">
                  Rua <span class="required">*</span>
                </label>
                <input
                  id="rua"
                  class="form-input capitalize-input"
                  type="text"
                  name="rua"
                  required
                  aria-required="true"
                />
              </div>
            </div>

            <!-- Número, Complemento -->
            <div class="form-row">
              <div class="form-field">
                <label for="numero" class="form-label">
                  Número <span class="required">*</span>
                </label>
                <input
                  id="numero"
                  class="form-input"
                  type="text"
                  name="numero"
                  required
                  aria-required="true"
                />
              </div>

              <div class="form-field">
                <label for="complemento" class="form-label">Complemento</label>
                <input
                  id="complemento"
                  class="form-input"
                  type="text"
                  name="complemento"
                />
              </div>
            </div>

            <!-- Bairro, Cidade, Estado -->
            <div class="form-row">
              <div class="form-field">
                <label for="bairro" class="form-label">
                  Bairro <span class="required">*</span>
                </label>
                <input
                  id="bairro"
                  class="form-input"
                  type="text"
                  name="bairro"
                  required
                  aria-required="true"
                />
              </div>

              <div class="form-field">
                <label for="cidade" class="form-label">
                  Cidade <span class="required">*</span>
                </label>
                <input
                  id="cidade"
                  class="form-input"
                  type="text"
                  name="cidade"
                  required
                  aria-required="true"
                />
              </div>

              <div class="form-field">
                <label for="estado" class="form-label">
                  UF <span class="required">*</span>
                </label>
                <input
                  id="estado"
                  class="form-input"
                  type="text"
                  name="estado"
                  required
                  aria-required="true"
                  maxlength="2"
                />
              </div>
            </div>

            <!-- Contato -->
            <div class="form-row">
              <div class="form-field">
                <label for="telefone" class="form-label">Telefone</label>
                <input
                  id="telefone"
                  class="form-input phone-mask"
                  type="text"
                  name="telefone"
                  inputmode="tel"
                />
              </div>

              <div class="form-field">
                <label for="celular" class="form-label">
                  Celular <span class="required">*</span>
                </label>
                <input
                  id="celular"
                  class="form-input cellphone-mask"
                  type="text"
                  name="celular"
                  required
                  aria-required="true"
                  inputmode="tel"
                />
              </div>
            </div>

            <!-- Email -->
            <div class="form-row">
              <div class="form-field">
                <label for="email" class="form-label">
                  Email <span class="required">*</span>
                </label>
                <input
                  id="email"
                  class="form-input"
                  type="email"
                  name="email"
                  required
                  aria-required="true"
                  inputmode="email"
                />
              </div>
            </div>

            <!-- Emergência -->
            <div class="form-row">
              <div class="form-field">
                <label for="nomeEmergencia" class="form-label">
                  Contato de emergência <span class="required">*</span>
                </label>
                <input
                  id="nomeEmergencia"
                  class="form-input capitalize-input"
                  type="text"
                  name="nomeEmergencia"
                  required
                  aria-required="true"
                />
              </div>

              <div class="form-field">
                <label for="vinculo" class="form-label">
                  Vínculo <span class="required">*</span>
                </label>
                <select
                  id="vinculo"
                  name="vinculo"
                  class="form-select"
                  required
                  aria-required="true"
                >
                  <option value="" disabled selected>Selecione</option>
                  {% for value, label in vinculo_choices %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="form-field">
                <label for="telEmergencia" class="form-label">
                  Telefone de emergência <span class="required">*</span>
                </label>
                <input
                  id="telEmergencia"
                  class="form-input phone-mask"
                  type="text"
                  name="telEmergencia"
                  required
                  aria-required="true"
                  inputmode="tel"
                />
              </div>
            </div>
          </div>

          <div class="form-navigation">
            <button type="button" class="btn btn-prev" aria-controls="step-1">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M19 12H5M5 12L12 19M5 12L12 5"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Voltar
            </button>

            <button type="submit" class="btn btn-submit" id="submitBtn">
              <span class="btn-text">Enviar Cadastro</span>
              <span class="btn-loading hidden">
                <svg class="spinner" viewBox="0 0 50 50">
                  <circle
                    class="path"
                    cx="25"
                    cy="25"
                    r="20"
                    fill="none"
                    stroke-width="5"
                  ></circle>
                </svg>
              </span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</main>

{% if messages %}
<div class="messages-container" id="alert-container">
    {% for message in messages %}
    <div class="alert {{ message.tags }}">
        <span class="icon">
            {% if message.tags == 'success' %}
            ✅
            {% elif message.tags == 'warning' %}
            ⚠️
            {% elif message.tags == 'error' %}
            ❌
            {% elif message.tags == 'info' %}
            ℹ️
            {% endif %}
        </span>
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script type="module" src="{% static 'core/js/pacientes/main.js' %}"></script>
<script src="https://unpkg.com/imask"></script>
<script src="{% static 'core/js/base/MaskAndInputsBase.js' %}"></script>
<script src="{% static 'core/js/base/validadorCpfCnpj.js' %}"></script>
<script src="{% static 'core/js/base/cep.js' %}"></script>
<script src="{% static 'core/js/pacientes/base.js' %}"></script>
<script>
console.log("Debug - Arquivos carregados:");
console.log({
    mainJs: typeof Main !== 'undefined',
    mask: typeof IMask !== 'undefined',
    base: typeof PacienteBase !== 'undefined'
});
</script>
 
{% endblock %}