{% load static %}
<!DOCTYPE html>

<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="{% static 'core/img/icons/logoRoxoFull.png' %}" type="image/png" />
  <title>Agenda Matrix - Ponto de Equilibro </title>
  <link rel="stylesheet" href="{% static 'core/css/tema.css' %}">
  <link rel="stylesheet" href="{% static 'core/css/agenda/agenda_matriz.css' %}">
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  

</head>
<body data-selected-date="{{ selected_date }}">
  <div class="professional-filter">
    <div class="date-picker">
      <input type="date" id="date-selector" value="{{ selected_date }}">
      <button id="today-btn">Hoje</button>
    </div>
    <select id="profissional-select" class="prof-select">
      <option value="">Todos os profissionais</option>
      {% for prof in profissionais %}
        <option value="{{ prof.id }}">{{ prof.nome }}</option>
      {% endfor %}
    </select>
    <div class="working-today">
      <label class='checkbox-option'>
        <input type="checkbox" id="working-today-check">
        Trabalha neste dia
      </label>
    </div>
  </div>

  <div class="date-filter">
    <div class="date-controls">
      <button id="prev-day"><i class="fas fa-chevron-left"></i></button>
      <h2 id="current-date">
        {% if is_today %}
          Hoje, {{ selected_date }}
        {% else %}
          {{ selected_date }}
        {% endif %}
      </h2>
      <button id="next-day"><i class="fas fa-chevron-right"></i></button>
    </div>

  </div>

  <div class="agenda-board">
    <!-- Coluna de Profissionais -->
    <div class="profissionais" id="profissionais-list">
      {% for prof in profissionais %}
        <div class="prof-card {% if not prof.tem_agenda %}sem-agenda{% endif %}" 
             data-prof-id="{{ prof.id }}"
             data-prof-name="{{ prof.nome }}">
          <i class="fas fa-user-md"></i> 
          <span>{{ prof.nome }}</span>
          {% if prof.tem_agenda %}
            <span style="font-size: 0.7rem; margin-left: auto; color: var(--roxoPrincipal);">●</span>
          {% endif %}
        </div>
      {% empty %}
        <div style="color: var(--text-light); text-align: center; padding: 20px;">
          Nenhum profissional encontrado
        </div>
      {% endfor %}
    </div>
  <!-- Área de horários -->
  <div class="horarios">
      <div class="table-container">
          <table id="agenda-table">
              <thead>
                  <tr>
                      <th class="horario-col">Horário</th>
                      {% for prof in profissionais %}
                          <th data-prof-id="{{ prof.id }}" data-prof-name="{{ prof.nome }}">
                              {{ prof.nome|truncatechars:20 }}
                          </th>
                      {% endfor %}
                  </tr>
              </thead>
              <tbody id="agenda-body">
                  {% for hora in horarios %}
                      <tr>
                          <td class="horario-col" data-hora="{{ hora }}">{{ hora }}</td>
                          {% for prof in profissionais %}
                              <td data-prof-id="{{ prof.id }}" data-hora="{{ hora }}">
                                  {% for ag in agendamentos %}
                                      {% if ag.profissional_1.id == prof.id and hora in ag.horarios_ocupados %}
                                        {% if hora == ag.slot_inicio %}
                                          <div class="paciente paciente-span"
                                              data-slots="{{ ag.qtd_slots }}"
                                              style="background: {{ ag.especialidade.cor|default:'#8b5cf6' }};"
                                              onclick="abrirDetalhesAgendamento({{ ag.id }})"
                                              title="Clique para ver detalhes">

                                            <!-- Linha 1: Paciente + ID -->
                                            <div class="ag-line ag-title">
                                              <i class="fas fa-user"></i>
                                              <span class="ag-text">{{ ag.paciente.nome|truncatechars:15 }}</span>
 
                                            </div>

                                            <!-- Linha 2: Sessão (só se tiver pacote) -->
                                            {% if ag.pacote %}
                                              <div class="ag-line">
                                                <i class="fas fa-layer-group"></i>
                                                <span>Sessão <strong>{{ ag.sessao_atual }}</strong> de <strong>{{ ag.pacote.qtd_sessoes }}</strong></span>
                                              </div>
                                            {% endif %}

                                            <!-- Linha 3: Ambiente (só se existir) -->
                                            {% if ag.ambiente %}
                                              <div class="ag-line">
                                                <i class="fas fa-door-open"></i>
                                                <span>{{ ag.ambiente }}</span>
                                              </div>
                                            {% endif %}

                                          </div>
                                        {% endif %}

                                      {% endif %}
                                  {% endfor %}
                              </td>
                          {% endfor %}
                      </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
  </div>
 
  </div>
  <div id="agendamento-modal" class="modal-overlay">

  </div>
  {% block scripts %}

  <script type="module" src="{% static 'core/js/alertas/main.js' %}"></script>
  <script src="{% static 'core/js/base/scriptBase.js' %}"></script>
  <script src="{% static 'core/js/agenda/agendaMatriz.js' %}"></script>
  

  {% endblock %}
</body>
</html>